{% extends "base.html" %}

{% block title %}Skorie – Session Reset{% endblock %}

{% block content %}

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7">

            <div class="card shadow-sm">
                <div class="card-body p-4">

                    <h1 class="h4 mb-3">Updating Your Skorie Account</h1>

                    <p>
                        We’ve introduced a new <strong>single sign-on</strong> system to make it much easier
                        to use different versions of Skorie (such as <em>skor.ie</em> and <em>ride.skor.ie</em>)
                        without needing to log in separately on each one.
                    </p>

                    <p>
                        You are seeing this page because you previously logged in using the old system and we need to clear out those old cookies.
                    </p>

                    <p>
                        You will need to perform this reset on <strong>each browser or device</strong> where
                        you previously used Skorie.

                    </p>

                    <p>
                        When you're ready, click the button below. This will completely clear old Skorie
                        cookies in this browser so you can log in again using the new system.
                    </p>

                    <form id="resetForm" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="next" value="{{ next }}">
                        <button type="button" class="btn btn-primary" onclick="resetCookiesAndSubmit()">Reset my session</button>
                    </form>

                    <script>
                        function resetCookiesAndSubmit() {
                            // Delete everything for this host and .skor.ie
                            const domains = [location.hostname, ".skor.ie"];
                            const cookies = document.cookie.split(";");

                            cookies.forEach(cookie => {
                                const name = cookie.split("=")[0].trim();
                                domains.forEach(domain => {
                                    document.cookie = `${name}=; Max-Age=0; path=/; domain=${domain}`;
                                });
                                document.cookie = `${name}=; Max-Age=0; path=/`; // host-only
                            });

                            // Submit POST after deleting
                            document.getElementById("resetForm").submit();
                        }
                    </script>

                </div>
            </div>

        </div>
    </div>
</div>

{% endblock %}
